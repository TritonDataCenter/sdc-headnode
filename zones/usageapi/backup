#!/usr/bin/bash

unset LD_LIBRARY_PATH
PATH=/usr/bin:/usr/sbin
export PATH

if [[ $# != 2 ]]; then
  echo "Usage: $0 <zone_name> <target_directory>"
  exit 1
fi

ZONE=$1
TARGET_DIR=$2
ROLE="usageapi"
CFG_FILE=/zones/${UUID}/root/opt/smartdc/usageapi/config/config.json

STAMP=$(date +'%F-%H-%M-%S-%Z')
BACKUP_VERSION="${ROLE}-${STAMP}"

ZONE_DATASET=$(zfs list -H -o name|grep "${ZONE}$")

# Create backup directory
mkdir -p "${TARGET_DIR}/${ROLE}"

echo "==> Saving config file for zone '${ZONE}'"
[ -f $CFG_FILE ] && cp $CFG_FILE ${TARGET_DIR}/${ROLE}

echo "==> Done!"
exit 0
