echo "99 finalizing rabbitmq pkg"

# Setup .erlang.cookie symlink
if [[ ! -f /root/.erlang.cookie ]]; then
	ln -s /var/db/rabbitmq/.erlang.cookie /root/.erlang.cookie
fi

# Setup erlang
if [[ -z $(/usr/bin/svcs -a|grep epmd) ]]; then
  echo "Importing epmd service"
  /usr/sbin/svccfg import /opt/local/share/smf/manifest/epmd.xml
  /usr/sbin/svcadm enable -s epmd
fi

if [[ -z $(/usr/bin/svcs -a|grep rabbitmq) ]]; then
  echo "Importing rabbitmq service"
  /usr/sbin/svccfg import /opt/local/share/smf/manifest/rabbitmq.xml
  /usr/sbin/svcadm enable -s rabbitmq
fi

#
# Call mdns_announce (imported from 97-zoneinit-common) to announce our
# service.
#
mdns_announce RabbitMQ 5672 _amqp-broker

